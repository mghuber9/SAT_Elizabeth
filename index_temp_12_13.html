<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lizzie's Digital SAT Practice Tests – Links & Scores</title>
  <style>
    :root{
      /* Bright Light Theme using Palette #3 accents (Periwinkle & Peach) */
      --bg: #F7F8FF;
      --card: #FFFFFF;
      --text: #1F2330;
      --muted: #6B7390;
      --brand: #6A8CFF;
      --accent: #FF9F80;
      --border: #D7DBF0;
      --brand-ink: #ffffff;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    header{
      padding:28px 16px;
      border-bottom:1px solid var(--border);
      background:linear-gradient(180deg,
        rgba(106,140,255,0.18),
        rgba(255,159,128,0.12) 60%,
        transparent);
    }
    h1{margin:0 0 6px;font-size:clamp(22px,3.2vw,34px)}
    p{margin:0;color:var(--muted)}
    .container{max-width:1100px;margin:0 auto;padding:20px 16px 56px;}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;margin:18px 0 24px}
    .spacer{flex:1}
    button,.linklike{
      appearance:none;
      border:2px solid var(--brand);
      background:var(--brand);
      color:var(--brand-ink);
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      text-decoration:none;
      box-shadow:0 2px 0 rgba(0,0,0,0.12);
    }
    button:hover,.linklike:hover{filter:brightness(1.05)}
    .sat-section{padding:22px 0 26px;border-top:2px solid var(--border)}
    .sat-header{display:flex;align-items:baseline;gap:10px;margin:6px 0 14px}
    .sat-title{font-size:18px;font-weight:900;color:#131729}
    .sat-sub{font-size:12px;color:var(--muted)}
    .sat-grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:12px}
    @media(min-width:800px){.sat-grid{grid-template-columns:repeat(4,minmax(0,1fr));}}
    .card{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      box-shadow:0 6px 16px rgba(18,24,46,0.06);
    }
    .card h3{margin:0;font-size:16px;color:#1c2140}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .muted{color:var(--muted);font-size:12px}
    .score{min-width:110px;font-weight:900;letter-spacing:0.2px}
    .badge{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#EEF1FF;color:#2a3375}
    .footer{margin-top:36px;color:var(--muted);font-size:13px}
    .totals{
      margin-top:12px;
      background:linear-gradient(90deg,rgba(106,140,255,0.14),rgba(255,159,128,0.10));
      border:1px solid var(--border);
      border-radius:14px;
      padding:12px;
      display:flex;
      flex-wrap:wrap;
      gap:12px;
    }
    .totals .chip{
      padding:8px 12px;
      border-radius:999px;
      border:1px dashed var(--brand);
      background:#EEF1FF;
      font-weight:800;
      color:#1F2330;
    }
    .totals label{font-size:12px;color:var(--muted);margin-right:6px;font-weight:700}

    /* Progress bars (baseline -> goal) */
    .progress-section{
      background:linear-gradient(180deg,#FFFFFF,#EEF1FF);
      border-bottom:2px solid var(--border);
      padding:20px 16px 24px;
    }
    .progress-inner{
      max-width:820px;
      margin:0 auto;
    }
    .progress-title{
      font-size:13px;
      font-weight:800;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:var(--muted);
      text-align:center;
      margin-bottom:10px;
    }
    .progress-row{
      margin:10px auto;
      display:grid;
      grid-template-columns:minmax(0,110px) 1fr minmax(0,200px);
      gap:12px;
      align-items:center;
      font-size:14px;
    }
    .progress-label{
      font-weight:700;
      color:#1F2330;
    }
    .progress-meta{
      text-align:right;
      color:var(--muted);
      white-space:nowrap;
      font-size:13px;
    }
    .progress-track{
      position:relative;
      height:14px;
      border-radius:999px;
      background:#D7DBF0;
      overflow:hidden;
    }
    .progress-fill{
      position:absolute;
      inset:0;
      width:0;
      background: var(--brand);
      transition:width .45s ease-out;
    }

    /* Countdown section */
    .countdown-section{
      background:#FFFFFF;
      border-bottom:2px solid var(--border);
      padding:12px 16px 16px;
    }
    .countdown-inner{
      max-width:820px;
      margin:0 auto;
      text-align:center;
    }
    .countdown-title{
      font-size:13px;
      font-weight:800;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:var(--muted);
      margin-bottom:6px;
    }
    .countdown-main{
      font-size:16px;
      font-weight:700;
      color:#1F2330;
      margin-bottom:4px;
    }
    .countdown-main .dot{
      margin:0 6px;
      opacity:0.4;
    }
    .countdown-days{
      color:var(--brand);
    }
    .countdown-sub{
      font-size:13px;
      color:var(--muted);
    }

    /* Assignments panel */
    .assignments-section{
      margin-top:18px;
      margin-bottom:24px;
      padding:14px 16px 16px;
      border-radius:16px;
      background:#FFFFFF;
      border:1px solid var(--border);
      box-shadow:0 6px 16px rgba(18,24,46,0.04);
    }
    .assignments-header h2{
      margin:0;
      font-size:18px;
      font-weight:900;
      color:#1c2140;
    }
    .assignments-header p{
      margin:4px 0 0;
      font-size:13px;
    }
    .assignments-login{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:flex-end;
      margin-top:10px;
      margin-bottom:10px;
    }
    .assignments-login label{
      display:flex;
      flex-direction:column;
      font-size:12px;
      color:var(--muted);
    }
    .assignments-login input{
      padding:6px 8px;
      border-radius:8px;
      border:1px solid var(--border);
      font-size:14px;
      min-width:120px;
    }
    .assignments-login button{
      padding:8px 12px;
      border-radius:10px;
      border:2px solid var(--brand);
      background:var(--brand);
      color:var(--brand-ink);
      font-size:13px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 2px 0 rgba(0,0,0,0.1);
    }
    .assignments-login button:hover{
      filter:brightness(1.05);
    }
    .assignments-list{
      list-style:none;
      padding:0;
      margin:4px 0 0;
    }
    .assignment-item{
      display:flex;
      gap:10px;
      align-items:flex-start;
      padding:8px 0;
      border-top:1px solid #ECEFFF;
    }
    .assignment-item:first-child{
      border-top:none;
    }
    .assignment-checkbox{
      margin-top:3px;
    }
    .assignment-title{
      font-size:14px;
      font-weight:600;
      color:#1F2330;
    }
    .assignment-meta{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }
    .assignment-saving{
      opacity:0.6;
    }
    .assignment-completed{
      text-decoration:line-through;
      opacity:0.5;
    }

    /* Focus tips strip */
    .focus-strip{
      background:#FFFFFF;
      border-bottom:2px solid var(--border);
      padding:14px 16px 18px;
    }
    .focus-title{
      font-size:13px;
      font-weight:800;
      letter-spacing:0.12em;
      text-transform:uppercase;
      color:var(--muted);
      text-align:center;
      margin-bottom:10px;
    }
    .focus-pill-row{
      display:flex;
      flex-wrap:wrap;
      justify-content:center;
      gap:10px;
    }
    .focus-pill{
      max-width:280px;
      padding:8px 12px;
      border-radius:999px;
      background:#EEF1FF;
      border:1px dashed var(--brand);
      font-size:13px;
      color:#1F2330;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Lizzie's Digital SAT Practice Tests</h1>
      <p>Quick links for SAT 1–6. Links and scores are set in this HTML only; students cannot edit on the page.</p>
    </div>
  </header>

  <!-- Progress bars (primary goals view, baseline → goal) -->
  <section class="progress-section">
    <div class="progress-inner">
      <div class="progress-title">Progress Toward Goal</div>

      <!-- Baseline/goal/current values -->
      <div class="progress-row"
           data-label="Verbal"
           data-baseline="500"
           data-goal="570"
           data-current="500"></div>

      <div class="progress-row"
           data-label="Math"
           data-baseline="500"
           data-goal="570"
           data-current="500"></div>

      <div class="progress-row"
           data-label="Composite"
           data-baseline="1000"
           data-goal="1140"
           data-current="1000"></div>
    </div>
  </section>

  <!-- Countdown to next SAT -->
  <section class="countdown-section">
    <div class="countdown-inner">
      <div class="countdown-title">Next SAT</div>
      <div class="countdown-main">
        <span id="sat-date-text"></span>
        <span class="dot">•</span>
        <span id="sat-days-remaining" class="countdown-days"></span>
      </div>
      <div class="countdown-sub">
        Registration deadline:
        <span id="sat-reg-text"></span>
      </div>
    </div>
  </section>

  <!-- Random focus tips -->
  <section class="focus-strip">
    <div class="focus-title">Today&apos;s Focus</div>
    <div id="focus-pills" class="focus-pill-row"></div>
  </section>

  <!-- Zoom banner -->
  <section style="background:#EEF1FF;padding:12px 16px;border-bottom:1px solid #D7DBF0;text-align:center;">
    <a href="https://us06web.zoom.us/j/7612376123" target="_blank"
       style="font-weight:700;color:#6A8CFF;text-decoration:none;font-size:16px;">
      Join Zoom Meeting
    </a>
    <div style="margin-top:4px;font-size:14px;color:#1F2330;">
      Passcode: <strong>728586</strong>
    </div>
  </section>

  <!-- Desmos banner -->
  <section style="background:#EEF1FF;padding:12px 16px;border-bottom:1px solid #D7DBF0;text-align:center;">
    <a href="https://www.desmos.com/testing/cb-sat-ap/graphing"
       onclick="window.open(this.href,'desmos','popup=yes,width=1200,height=800,left=120,top=80,menubar=no,toolbar=no,location=no,status=no,scrollbars=yes,resizable=yes');return false;"
       style="font-weight:700;color:#6A8CFF;text-decoration:none;font-size:16px;">
      Open Desmos Calculator
    </a>
  </section>

  <main class="container">

    <!-- Next 5 Assignments -->
    <section class="assignments-section">
      <div class="assignments-header">
        <h2>Next 5 Assignments</h2>
        <p class="muted">Log in with your ID and PIN to see your upcoming work.</p>
      </div>
      <form id="login-form" class="assignments-login">
        <label>
          Student ID
          <input type="text" id="student-id" autocomplete="username" required>
        </label>
        <label>
          PIN
          <input type="password" id="student-pin" inputmode="numeric" autocomplete="current-password" required>
        </label>
        <button type="submit">Load Assignments</button>
        <span id="login-status" class="muted"></span>
      </form>
      <ul id="assignments-list" class="assignments-list"></ul>
    </section>

    <div class="toolbar">
      <span class="spacer"></span>
      <button onclick="window.print()">Print</button>
    </div>

    <div id="wrap"></div>

    <section class="footer">
      <p><span class="badge">Tip</span> Host on GitHub Pages and embed in Google Sites (iframe). Edit the URLs in <strong>DEFAULT_LINKS</strong> and the scores in the <strong>SCORES</strong> JSON below.</p>
    </section>
  </main>

  <!-- ===== Shared Scores Configuration ===== -->
  <script id="SHARED_SCORES" type="application/json">
  {
    "SAT 1": {
      "Math Module 1": "—", "Math Module 2": "—", "R&W Module 1": "—", "R&W Module 2": "—",
      "Composite Math": "—", "Composite Verbal": "—", "Overall": "—"
    },
    "SAT 2": {
      "Math Module 1": "—", "Math Module 2": "—", "R&W Module 1": "—", "R&W Module 2": "—",
      "Composite Math": "—", "Composite Verbal": "—", "Overall": "—"
    },
    "SAT 3": {
      "Math Module 1": "—", "Math Module 2": "—", "R&W Module 1": "—", "R&W Module 2": "—",
      "Composite Math": "—", "Composite Verbal": "—", "Overall": "—"
    },
    "SAT 4": {
      "Math Module 1": "—", "Math Module 2": "—", "R&W Module 1": "—", "R&W Module 2": "—",
      "Composite Math": "—", "Composite Verbal": "—", "Overall": "—"
    },
    "SAT 5": {
      "Math Module 1": "—", "Math Module 2": "—", "R&W Module 1": "—", "R&W Module 2": "—",
      "Composite Math": "—", "Composite Verbal": "—", "Overall": "—"
    },
    "SAT 6": {
      "Math Module 1": "—", "Math Module 2": "—", "R&W Module 1": "—", "R&W Module 2": "—",
      "Composite Math": "—", "Composite Verbal": "—", "Overall": "—"
    }
  }
  </script>

  <!-- Main SAT / progress logic -->
  <script>
  document.addEventListener("DOMContentLoaded", function(){

    /* -------- Focus tips ------- */
    var FOCUS_TIPS = [
      'Review why you missed, not just what you missed.',
      'Study 20 focused minutes daily > 3 hours once a week.',
      'Track your errors by type (concept, careless, time).',
      'Build your own SAT “mistake journal.”',
      'Re-solve missed questions a week later to test retention.',
      'Simulate test timing at least twice before test day.',
      'Use the same calculator you’ll bring to the test.',
      'Set micro-goals: “I’ll master one skill this session.”',
      'Talk through a problem out loud as if teaching it.',
      'Revisit easy wins to build confidence before tough sets.',
      'Study in the same posture/environment you’ll test in.',
      'Keep a simple checklist for test day (ID, calculator, snacks).',
      'Don’t aim for perfect—aim for a little better than last week.',
      'Review your wrong answers before closing your notebook.',
      'Predict answers before looking at choices.',
      'Reward consistency, not perfection.'
    ];

    var focusWrap = document.getElementById("focus-pills");
    if (focusWrap) {
      var pool = FOCUS_TIPS.slice();
      var count = Math.min(3, pool.length);
      for (var i = 0; i < count; i++) {
        var idx = Math.floor(Math.random() * pool.length);
        var tip = pool.splice(idx, 1)[0];
        var pill = document.createElement("div");
        pill.className = "focus-pill";
        pill.textContent = tip;
        focusWrap.appendChild(pill);
      }
    }

    /* -------- Progress bars (baseline → goal) -------- */
    function buildProgress(){
      var rows = document.querySelectorAll(".progress-row");
      (rows.forEach || Array.prototype.forEach).call(rows, function(row){
        var label    = row.getAttribute("data-label")    || "";
        var baseline = parseInt(row.getAttribute("data-baseline"), 10);
        var goal     = parseInt(row.getAttribute("data-goal"), 10);
        var current  = parseInt(row.getAttribute("data-current"), 10);

        if (isNaN(baseline)) baseline = 0;
        if (!goal || goal <= baseline) goal = baseline + 1;
        if (isNaN(current)) current = baseline;

        // clamp between baseline and goal
        if (current < baseline) current = baseline;
        if (current > goal)     current = goal;

        var span   = goal - baseline;
        var gained = current - baseline;
        var pct    = Math.round((gained / span) * 100);

        row.innerHTML = "";

        var left = document.createElement("div");
        left.className = "progress-label";
        left.textContent = label;

        var track = document.createElement("div");
        track.className = "progress-track";
        var fill = document.createElement("div");
        fill.className = "progress-fill";
        fill.style.width = pct + "%";
        track.appendChild(fill);

        var right = document.createElement("div");
        right.className = "progress-meta";
        right.textContent =
          baseline + " → " + current + " / " + goal +
          " (+" + gained + " from baseline)";

        row.appendChild(left);
        row.appendChild(track);
        row.appendChild(right);
      });
    }

    /* -------- Countdown to next SAT -------- */
    function setupCountdown(){
      // Months are 0-based: 11 = December, 10 = November
      var testDate = new Date(2025, 11, 6);  // Dec 6, 2025
      var regDate  = new Date(2025, 10, 21); // Nov 21, 2025

      var opts = { year:"numeric", month:"long", day:"numeric" };

      var dateEl = document.getElementById("sat-date-text");
      var daysEl = document.getElementById("sat-days-remaining");
      var regEl  = document.getElementById("sat-reg-text");
      if (!dateEl || !daysEl || !regEl) return;

      dateEl.textContent = testDate.toLocaleDateString(undefined, opts);
      regEl.textContent  = regDate.toLocaleDateString(undefined, opts);

      var today   = new Date();
      var diffMs  = testDate - today;
      var diffDay = Math.ceil(diffMs / (1000*60*60*24));

      if (diffDay >= 0){
        daysEl.textContent = diffDay + " day" + (diffDay === 1 ? "" : "s") + " to go";
      } else {
        daysEl.textContent = "test date has passed";
      }
    }

    buildProgress();
    setupCountdown();

    /* -------- SAT links and scores rendering -------- */
    var DEFAULT_LINKS = {
      "SAT 1": {
        "Math Module 1": "https://www.zipgrade.com/s/h4nlr0u/",
        "Math Module 2": "https://www.zipgrade.com/s/tk1i4pm/",
        "R&W Module 1": "https://www.zipgrade.com/s/0IipBD8/",
        "R&W Module 2": "https://www.zipgrade.com/s/RtgiO6W/"
      },
      "SAT 2": { "Math Module 1": "#", "Math Module 2": "#", "R&W Module 1": "#", "R&W Module 2": "#" },
      "SAT 3": { "Math Module 1": "#", "Math Module 2": "#", "R&W Module 1": "#", "R&W Module 2": "#" },
      "SAT 4": { "Math Module 1": "#", "Math Module 2": "#", "R&W Module 1": "#", "R&W Module 2": "#" },
      "SAT 5": { "Math Module 1": "#", "Math Module 2": "#", "R&W Module 1": "#", "R&W Module 2": "#" },
      "SAT 6": { "Math Module 1": "#", "Math Module 2": "#", "R&W Module 1": "#", "R&W Module 2": "#" }
    };

    function getSharedScores(){
      try{
        var json = document.getElementById("SHARED_SCORES").textContent;
        return JSON.parse(json);
      }catch(e){
        console.warn("Could not parse SHARED_SCORES JSON:", e);
        return {};
      }
    }

    var wrap = document.getElementById("wrap");
    var links = DEFAULT_LINKS;
    var sharedScores = getSharedScores();

    render();

    function render(){
      wrap.innerHTML = "";
      var tests = Object.keys(links).sort(function(a,b){
        return (+a.split(" ")[1]) - (+b.split(" ")[1]);
      });
      tests.forEach(function(testName){
        wrap.appendChild(section(testName));
      });
    }

    function section(testName){
      var sec = el("section", {class:"sat-section"});
      var header = el("div", {class:"sat-header"});
      header.append(
        el("div", {class:"sat-title"}, testName),
        el("div", {class:"sat-sub"}, "Modules & composites")
      );
      sec.append(header);

      var grid = el("div", {class:"sat-grid"});
      ["Math Module 1","Math Module 2","R&W Module 1","R&W Module 2"].forEach(function(mod){
        grid.append(card(testName, mod, links[testName][mod]));
      });
      sec.append(grid);

      var totals = el("div", {class:"totals"});
      totals.append(
        totalChip("Composite Math", scoreOf(testName,"Composite Math")),
        totalChip("Composite Verbal", scoreOf(testName,"Composite Verbal")),
        totalChip("Overall", scoreOf(testName,"Overall"))
      );
      sec.append(totals);

      return sec;
    }

    function totalChip(label, value){
      var chip = el("div", {class:"chip"});
      var l = el("label", {}, label + ":");
      var v = el("span", {class:"score", title:"Edit in SCORES JSON"}, value || "—");
      chip.append(l, v);
      return chip;
    }

    function scoreOf(testName, key){
      var ts = sharedScores && sharedScores[testName];
      return (ts && ts[key]) ? ts[key] : "—";
    }

    function card(testName, moduleName, url){
      var card = el("div", {class:"card"});
      var header = el("div", {class:"row"});
      header.append(el("h3", {}, moduleName));
      card.append(header);

      var row1 = el("div", {class:"row"});
      var link = el("a", {
        class:"linklike",
        href:url || "#",
        target:"_blank",
        rel:"noopener noreferrer"
      }, "Open Test");
      row1.append(link);
      card.append(row1);

      var row2 = el("div", {class:"row"});
      var ts = sharedScores && sharedScores[testName];
      var val = (ts && ts[moduleName]) ? ts[moduleName] : "—";
      var score = el("span", {class:"score", title:"Edit in SCORES JSON"}, val);
      row2.append(score, el("span", {class:"muted"}, "Shared (from HTML)"));
      card.append(row2);

      return card;
    }

    function el(tag, attrs, text){
      if (!attrs) attrs = {};
      var n = document.createElement(tag);
      Object.keys(attrs).forEach(function(k){ n.setAttribute(k, attrs[k]); });
      if (text != null) n.append(document.createTextNode(text));
      return n;
    }

    // ===== NEW: update SAT 1–6 scores from server assignments =====
    // It expects an array like: [{ assignment_id: "SAT1_M1", score: 570 }, ...]
    window.updateScoresFromServer = function(assignments){
      if (!Array.isArray(assignments)) return;

      // 1) Update individual module scores
      assignments.forEach(function(item){
        var id    = (item && item.assignment_id) || "";
        var score = item && item.score;

        if (!id || score === undefined || score === null || score === "") return;

        var m = /^SAT(\d+)_(M1|M2|RW1|RW2)$/.exec(id);
        if (!m) return;

        var satNum = m[1];
        var code   = m[2];

        var testName   = "SAT " + satNum;
        var moduleName = null;
        if (code === "M1")  moduleName = "Math Module 1";
        if (code === "M2")  moduleName = "Math Module 2";
        if (code === "RW1") moduleName = "R&W Module 1";
        if (code === "RW2") moduleName = "R&W Module 2";
        if (!moduleName) return;

        if (!sharedScores[testName]) sharedScores[testName] = {};
        sharedScores[testName][moduleName] = String(score);
      });

      // 2) Compute composites
      function num(val){
        var n = parseFloat(val);
        return isNaN(n) ? null : n;
      }

      Object.keys(sharedScores || {}).forEach(function(testName){
        var ts = sharedScores[testName] || {};

        var m1  = num(ts["Math Module 1"]);
        var m2  = num(ts["Math Module 2"]);
        var rw1 = num(ts["R&W Module 1"]);
        var rw2 = num(ts["R&W Module 2"]);

        // Composite Math: sum of math modules
        if (m1 != null && m2 != null){
          ts["Composite Math"] = String(m1 + m2);
        }

        // Composite Verbal: sum of R&W modules
        if (rw1 != null && rw2 != null){
          ts["Composite Verbal"] = String(rw1 + rw2);
        }

        // Overall: Composite Math + Composite Verbal
        var cm = num(ts["Composite Math"]);
        var cv = num(ts["Composite Verbal"]);
        if (cm != null && cv != null){
          ts["Overall"] = String(cm + cv);
        }
      });

      // 3) Rebuild SAT cards
      render();

      // 4) Update progress bars
      updateProgressFromSharedScores();
    };

    // Use the best completed SAT to drive the progress bars
    function updateProgressFromSharedScores(){
      if (!sharedScores) return;

      function num(val){
        var n = parseFloat(val);
        return isNaN(n) ? null : n;
      }

      var best = null;

      Object.keys(sharedScores || {}).forEach(function(testName){
        var ts = sharedScores[testName] || {};
        var cm = num(ts["Composite Math"]);
        var cv = num(ts["Composite Verbal"]);
        if (cm == null || cv == null) return;

        var total = cm + cv;
        if (!best || total > best.total){
          best = {
            math: cm,
            verbal: cv,
            composite: total
          };
        }
      });

      if (!best) return;

      var rows = document.querySelectorAll(".progress-row");
      (rows.forEach || Array.prototype.forEach).call(rows, function(row){
        var label = row.getAttribute("data-label") || "";
        var val   = null;
        if (label === "Verbal")      val = best.verbal;
        else if (label === "Math")   val = best.math;
        else if (label === "Composite") val = best.composite;

        if (val != null){
          row.setAttribute("data-current", String(val));
        }
      });

      buildProgress();
    }

  });
  </script>

  <!-- Assignments / login script -->
  <script>
    const ASSIGNMENTS_API_URL = 'https://script.google.com/macros/s/AKfycbzQJBcPfXk2QRRVQpRjIQlcCjxDPXkDRm1wlR7AWoycj_X7eunvsN-T2RWINP8QTGDX/exec';

    document.addEventListener('DOMContentLoaded', function(){
      const apiUrl    = ASSIGNMENTS_API_URL;
      const form      = document.getElementById('login-form');
      const listEl    = document.getElementById('assignments-list');
      const statusEl  = document.getElementById('login-status');
      const idInput   = document.getElementById('student-id');
      const pinInput  = document.getElementById('student-pin');

      if (!form || !listEl) return;

      let currentStudent = null;

      form.addEventListener('submit', function(ev){
        ev.preventDefault();
        const studentId = idInput.value.trim();
        const pin       = pinInput.value.trim();
        if (!studentId || !pin) return;
        statusEl.textContent = 'Loading...';
        loadAssignments(studentId, pin);
      });

      async function loadAssignments(studentId, pin){
        try{
          const qs = new URLSearchParams({
            action: 'getAssignments',
            student_id: studentId,
            pin: pin
          });
          const res  = await fetch(apiUrl + '?' + qs.toString());
          const data = await res.json();

          if (!res.ok || data.error){
            statusEl.textContent = data.error || 'Error loading assignments.';
            listEl.innerHTML = '';
            return;
          }

          currentStudent = { studentId, pin };
          statusEl.textContent = 'Showing your next assignments.';

          // Next 5 list
          renderAssignments(data.assignments || []);

          // Full SAT list for scorecards
          var satList = (data.satAssignments && data.satAssignments.length)
            ? data.satAssignments
            : (data.assignments || []);

          window.updateScoresFromServer(satList);

        }catch(err){
          console.error(err);
          statusEl.textContent = 'Network error – please try again.';
          listEl.innerHTML = '';
        }
      }

      function renderAssignments(items){
        listEl.innerHTML = '';
        if (!items.length){
          const li = document.createElement('li');
          li.textContent = 'No upcoming assignments yet.';
          listEl.appendChild(li);
          return;
        }

        items.slice(0,5).forEach(item => {
          const li = document.createElement('li');
          li.className = 'assignment-item';

          const checkbox = document.createElement('input');
          checkbox.type = 'checkbox';
          checkbox.className = 'assignment-checkbox';
          checkbox.addEventListener('change', function(){
            if (checkbox.checked){
              markCompleted(item.assignment_id, li, checkbox);
            }
          });

          const textWrap = document.createElement('div');
          const titleEl = document.createElement('div');
          titleEl.className = 'assignment-title';
          titleEl.textContent = item.title || '(Untitled assignment)';

          const metaEl = document.createElement('div');
          metaEl.className = 'assignment-meta';
          const parts = [];
          if (item.due_date_human){
            parts.push('Due: ' + item.due_date_human);
          }
          if (item.score !== undefined && item.score !== '' && item.score != null){
            parts.push('Score: ' + item.score);
          }
          metaEl.textContent = parts.join(' · ');

          textWrap.appendChild(titleEl);
          textWrap.appendChild(metaEl);

          li.appendChild(checkbox);
          li.appendChild(textWrap);
          listEl.appendChild(li);
        });
      }

      async function markCompleted(assignmentId, li, checkbox){
        if (!currentStudent) return;
        li.classList.add('assignment-saving');

        try{
          const qs = new URLSearchParams({
            action: 'completeAssignment',
            student_id: currentStudent.studentId,
            pin: currentStudent.pin,
            assignment_id: assignmentId
          });
          const res  = await fetch(apiUrl + '?' + qs.toString());
          const data = await res.json();

          if (!res.ok || data.error){
            statusEl.textContent = data.error || 'Could not update assignment.';
            li.classList.remove('assignment-saving');
            checkbox.checked = false;
            return;
          }

          statusEl.textContent = 'Nice work – assignment marked complete.';
          li.classList.add('assignment-completed');
          setTimeout(() => li.remove(), 400);
        }catch(err){
          console.error(err);
          statusEl.textContent = 'Network error while updating.';
          li.classList.remove('assignment-saving');
          checkbox.checked = false;
        }
      }
    });
  </script>
</body>
</html>
